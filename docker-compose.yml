version: '2'

services:
  frontend: 
    build: ./frontend
    working_dir: /frontend
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/frontend
    depends_on:
      - backend
    environment:
      - REACT_APP_BACKEND_ENDPOINT=http://localhost:4000
      - PORT=3000

  frontend_tests: 
    image: node:9-alpine
    working_dir: /frontend
    command: "yarn test"
    volumes:
      - ./frontend:/frontend
    environment:
      - CI=true

  backend: 
    build: ./backend
    working_dir: /backend
    ports:
      - "4000:4000"
    volumes:
      - ./backend:/backend
    depends_on:
      - database
    environment:
      - DB_ADDRESS=database:27017
      - PORT=4000
      - DB_NAME=gravnic-level-creator

  backend_tests: 
    image: node:9-alpine
    working_dir: /backend
    command: "yarn test --forceExit"
    volumes:
      - ./backend:/backend
    depends_on:
      - database
    environment:
      - DB_NAME=gravnic-level-creator-test
      - DB_ADDRESS=database:27017
      - PORT=5001
      - LOG_LEVEL=debug
      - MORGAN_LOGGING=OFF
      - CI=true

  e2e: 
    build: ./e2e
    working_dir: /e2e
    environment:
      - FRONTEND_URL=frontend:3000
    depends_on:
      - frontend
      - backend

  database: 
    image: mongo 